
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Registry Compatibility · distribution 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="describes get by digest pitfall">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="configuration.html" />
    
    
    <link rel="prev" href="architecture.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" >
            
                <span>
            
                    
                    Recipes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="recipes/apache.html">
            
                <a href="recipes/apache.html">
            
                    
                    Authenticate Proxy With Apache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="recipes/">
            
                <a href="recipes/">
            
                    
                    Recipes Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="recipes/mirror.html">
            
                <a href="recipes/mirror.html">
            
                    
                    Registry As A Pull Through Cache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="recipes/nginx.html">
            
                <a href="recipes/nginx.html">
            
                    
                    Authenticate Proxy With Nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="recipes/osx-setup-guide.html">
            
                <a href="recipes/osx-setup-guide.html">
            
                    
                    Mac OS Setup Guide
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Spec
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    Auth
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="spec/auth/">
            
                <a href="spec/auth/">
            
                    
                    Docker Registry Token Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="spec/auth/jwt.html">
            
                <a href="spec/auth/jwt.html">
            
                    
                    Token Authentication Implementation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="spec/auth/oauth.html">
            
                <a href="spec/auth/oauth.html">
            
                    
                    Oauth 2 Token Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="spec/auth/scope.html">
            
                <a href="spec/auth/scope.html">
            
                    
                    Token Scope Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="spec/auth/token.html">
            
                <a href="spec/auth/token.html">
            
                    
                    Token Authentication Specification
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="spec/api.html">
            
                <a href="spec/api.html">
            
                    
                    HTTP API V 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="spec/deprecated-schema-v1.html">
            
                <a href="spec/deprecated-schema-v1.html">
            
                    
                    Update Deprecated Schema Image Manifest Version 2 V 1 Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="spec/implementations.html">
            
                <a href="spec/implementations.html">
            
                    
                    Implementations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="spec/">
            
                <a href="spec/">
            
                    
                    Reference Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="spec/json.html">
            
                <a href="spec/json.html">
            
                    
                    Docker Distribution JSON Canonicalization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="spec/manifest-v2-1.html">
            
                <a href="spec/manifest-v2-1.html">
            
                    
                    Image Manifest V 2 Schema 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="spec/manifest-v2-2.html">
            
                <a href="spec/manifest-v2-2.html">
            
                    
                    Image Manifest V 2 Schema 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="spec/menu.html">
            
                <a href="spec/menu.html">
            
                    
                    Reference
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Storage Drivers
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="storage-drivers/azure.html">
            
                <a href="storage-drivers/azure.html">
            
                    
                    Microsoft Azure Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="storage-drivers/filesystem.html">
            
                <a href="storage-drivers/filesystem.html">
            
                    
                    Filesystem Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="storage-drivers/gcs.html">
            
                <a href="storage-drivers/gcs.html">
            
                    
                    Google Cloud Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="storage-drivers/">
            
                <a href="storage-drivers/">
            
                    
                    Registry Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="storage-drivers/inmemory.html">
            
                <a href="storage-drivers/inmemory.html">
            
                    
                    In Memory Storage Driver Testing Only
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="storage-drivers/oss.html">
            
                <a href="storage-drivers/oss.html">
            
                    
                    Aliyun OSS Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="storage-drivers/s3.html">
            
                <a href="storage-drivers/s3.html">
            
                    
                    S 3 Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="storage-drivers/swift.html">
            
                <a href="storage-drivers/swift.html">
            
                    
                    Open Stack Swift Storage Driver
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="architecture.html">
            
                <a href="architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="compatibility.html">
            
                <a href="compatibility.html">
            
                    
                    Registry Compatibility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="configuration.html">
            
                <a href="configuration.html">
            
                    
                    Configuring A Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="deploying.html">
            
                <a href="deploying.html">
            
                    
                    Deploy A Registry Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="deprecated.html">
            
                <a href="deprecated.html">
            
                    
                    Docker Registry Deprecation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="garbage-collection.html">
            
                <a href="garbage-collection.html">
            
                    
                    Garbage Collection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="glossary.html">
            
                <a href="glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="help.html">
            
                <a href="help.html">
            
                    
                    Get Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="insecure.html">
            
                <a href="insecure.html">
            
                    
                    Test An Insecure Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                    About Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="migration.html">
            
                <a href="migration.html">
            
                    
                    Migration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="notifications.html">
            
                <a href="notifications.html">
            
                    
                    Work With Notifications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="./">
            
                <a href="./">
            
                    
                    Docker Registry
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Registry Compatibility</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="synopsis">Synopsis</h2>
<p>If a manifest is pulled by <em>digest</em> from a registry 2.3 with Docker Engine 1.9
and older, and the manifest was pushed with Docker Engine 1.10, a security check
causes the Engine to receive a manifest it cannot use and the pull fails.</p>
<h2 id="registry-manifest-support">Registry manifest support</h2>
<p>Historically, the registry has supported a <a href="spec/manifest-v2-1.html">single manifest type</a>
known as <em>Schema 1</em>.</p>
<p>With the move toward multiple architecture images, the distribution project
introduced two new manifest types: Schema 2 manifests and manifest lists. Registry
2.3 supports all three manifest types and sometimes performs an on-the-fly
transformation of a manifest before serving the JSON in the response, to
preserve compatibility with older versions of Docker Engine.</p>
<p>This conversion has some implications for pulling manifests by digest and this
document enumerates these implications.</p>
<h2 id="content-addressable-storage-cas">Content Addressable Storage (CAS)</h2>
<p>Manifests are stored and retrieved in the registry by keying off a digest
representing a hash of the contents. One of the advantages provided by CAS is
security: if the contents are changed, then the digest no longer matches.
This prevents any modification of the manifest by a MITM attack or an untrusted
third party.</p>
<p>When a manifest is stored by the registry, this digest is returned in the HTTP
response headers and, if events are configured, delivered within the event. The
manifest can either be retrieved by the tag, or this digest.</p>
<p>For registry versions 2.2.1 and below, the registry always stores and
serves <em>Schema 1</em> manifests. Engine 1.10 first
attempts to send a <em>Schema 2</em> manifest, falling back to sending a
Schema 1 type manifest when it detects that the registry does not
support the new version.</p>
<h2 id="registry-v23">Registry v2.3</h2>
<h3 id="manifest-push-with-docker-110">Manifest push with Docker 1.10</h3>
<p>The Engine constructs a <em>Schema 2</em> manifest which the
registry persists to disk.</p>
<p>When the manifest is pulled by digest or tag with Docker Engine 1.10, a
<em>Schema 2</em> manifest is returned. Docker Engine 1.10
understands the new manifest format.</p>
<p>When the manifest is pulled by <em>tag</em> with Docker Engine 1.9 and older, the
manifest is converted on-the-fly to <em>Schema 1</em> and sent in the
response. The Docker Engine 1.9 is compatible with this older format.</p>
<p>When the manifest is pulled by <em>digest</em> with Docker Engine 1.9 and older, the
same rewriting process does not happen in the registry. If it did,
the digest would no longer match the hash of the manifest and would violate the
constraints of CAS.</p>
<p>For this reason if a manifest is pulled by <em>digest</em> from a registry 2.3 with Docker
Engine 1.9 and older, and the manifest was pushed with Docker Engine 1.10, a
security check causes the Engine to receive a manifest it cannot use and the
pull fails.</p>
<h3 id="manifest-push-with-docker-19-and-older">Manifest push with Docker 1.9 and older</h3>
<p>The Docker Engine constructs a <em>Schema 1</em> manifest which the
registry persists to disk.</p>
<p>When the manifest is pulled by digest or tag with any Docker version, a
<em>Schema 1</em> manifest is returned.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="architecture.html" class="navigation navigation-prev " aria-label="Previous page: Architecture">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="configuration.html" class="navigation navigation-next " aria-label="Next page: Configuring A Registry">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"description":"describes get by digest pitfall","keywords":"registry, manifest, images, tags, repository, distribution, digest","title":"Registry Compatibility","level":"1.5","depth":1,"next":{"title":"Configuring A Registry","level":"1.6","depth":1,"path":"configuration.md","ref":"configuration.md","articles":[]},"previous":{"title":"Architecture","level":"1.4","depth":1,"path":"architecture.md","ref":"architecture.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"distribution 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"compatibility.md","mtime":"2023-01-31T01:27:31.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-01-31T01:28:02.961Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

