
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Docker Distribution JSON Canonicalization · distribution 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="Explains registry JSON objects">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="manifest-v2-1.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" >
            
                <span>
            
                    
                    Recipes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../recipes/apache.html">
            
                <a href="../recipes/apache.html">
            
                    
                    Authenticate Proxy With Apache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../recipes/">
            
                <a href="../recipes/">
            
                    
                    Recipes Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="../recipes/mirror.html">
            
                <a href="../recipes/mirror.html">
            
                    
                    Registry As A Pull Through Cache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../recipes/nginx.html">
            
                <a href="../recipes/nginx.html">
            
                    
                    Authenticate Proxy With Nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="../recipes/osx-setup-guide.html">
            
                <a href="../recipes/osx-setup-guide.html">
            
                    
                    Mac OS Setup Guide
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Spec
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    Auth
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="auth/">
            
                <a href="auth/">
            
                    
                    Docker Registry Token Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="auth/jwt.html">
            
                <a href="auth/jwt.html">
            
                    
                    Token Authentication Implementation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="auth/oauth.html">
            
                <a href="auth/oauth.html">
            
                    
                    Oauth 2 Token Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="auth/scope.html">
            
                <a href="auth/scope.html">
            
                    
                    Token Scope Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="auth/token.html">
            
                <a href="auth/token.html">
            
                    
                    Token Authentication Specification
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="api.html">
            
                <a href="api.html">
            
                    
                    HTTP API V 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="deprecated-schema-v1.html">
            
                <a href="deprecated-schema-v1.html">
            
                    
                    Update Deprecated Schema Image Manifest Version 2 V 1 Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="implementations.html">
            
                <a href="implementations.html">
            
                    
                    Implementations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="./">
            
                <a href="./">
            
                    
                    Reference Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.6" data-path="json.html">
            
                <a href="json.html">
            
                    
                    Docker Distribution JSON Canonicalization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="manifest-v2-1.html">
            
                <a href="manifest-v2-1.html">
            
                    
                    Image Manifest V 2 Schema 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="manifest-v2-2.html">
            
                <a href="manifest-v2-2.html">
            
                    
                    Image Manifest V 2 Schema 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="menu.html">
            
                <a href="menu.html">
            
                    
                    Reference
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Storage Drivers
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../storage-drivers/azure.html">
            
                <a href="../storage-drivers/azure.html">
            
                    
                    Microsoft Azure Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../storage-drivers/filesystem.html">
            
                <a href="../storage-drivers/filesystem.html">
            
                    
                    Filesystem Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../storage-drivers/gcs.html">
            
                <a href="../storage-drivers/gcs.html">
            
                    
                    Google Cloud Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../storage-drivers/">
            
                <a href="../storage-drivers/">
            
                    
                    Registry Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../storage-drivers/inmemory.html">
            
                <a href="../storage-drivers/inmemory.html">
            
                    
                    In Memory Storage Driver Testing Only
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../storage-drivers/oss.html">
            
                <a href="../storage-drivers/oss.html">
            
                    
                    Aliyun OSS Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../storage-drivers/s3.html">
            
                <a href="../storage-drivers/s3.html">
            
                    
                    S 3 Storage Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../storage-drivers/swift.html">
            
                <a href="../storage-drivers/swift.html">
            
                    
                    Open Stack Swift Storage Driver
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../architecture.html">
            
                <a href="../architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../compatibility.html">
            
                <a href="../compatibility.html">
            
                    
                    Registry Compatibility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../configuration.html">
            
                <a href="../configuration.html">
            
                    
                    Configuring A Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../deploying.html">
            
                <a href="../deploying.html">
            
                    
                    Deploy A Registry Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../deprecated.html">
            
                <a href="../deprecated.html">
            
                    
                    Docker Registry Deprecation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../garbage-collection.html">
            
                <a href="../garbage-collection.html">
            
                    
                    Garbage Collection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../glossary.html">
            
                <a href="../glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../help.html">
            
                <a href="../help.html">
            
                    
                    Get Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../insecure.html">
            
                <a href="../insecure.html">
            
                    
                    Test An Insecure Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../introduction.html">
            
                <a href="../introduction.html">
            
                    
                    About Registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../migration.html">
            
                <a href="../migration.html">
            
                    
                    Migration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../notifications.html">
            
                <a href="../notifications.html">
            
                    
                    Work With Notifications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../">
            
                <a href="../">
            
                    
                    Docker Registry
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Docker Distribution JSON Canonicalization</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="docker-distribution-json-canonicalization">Docker Distribution JSON Canonicalization</h1>
<p>To provide consistent content hashing of JSON objects throughout Docker
Distribution APIs, the specification defines a canonical JSON format. Adopting
such a canonicalization also aids in caching JSON responses.</p>
<p>Note that protocols should not be designed to depend on identical JSON being
generated across different versions or clients. The canonicalization rules are
merely useful for caching and consistency.</p>
<h2 id="rules">Rules</h2>
<p>Compliant JSON should conform to the following rules:</p>
<ol>
<li>All generated JSON should comply with <a href="http://www.ietf.org/rfc/rfc7159.txt" target="_blank">RFC
7159</a>.</li>
<li>Resulting &quot;JSON text&quot; shall always be encoded in UTF-8.</li>
<li>Unless a canonical key order is defined for a particular schema, object
keys shall always appear in lexically sorted order.</li>
<li>All whitespace between tokens should be removed.</li>
<li>No &quot;trailing commas&quot; are allowed in object or array definitions.</li>
<li>The angle brackets &quot;&lt;&quot; and &quot;&gt;&quot; are escaped to &quot;\u003c&quot; and &quot;\u003e&quot;.
Ampersand &quot;&amp;&quot; is escaped to &quot;\u0026&quot;.</li>
</ol>
<h2 id="examples">Examples</h2>
<p>The following is a simple example of a canonicalized JSON string:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span><span class="token property">&quot;asdf&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;qwer&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;zxcv&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token number">1000000000</span><span class="token punctuation">,</span><span class="token string">&quot;tyui&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre>
<h2 id="reference">Reference</h2>
<h3 id="other-canonicalizations">Other Canonicalizations</h3>
<p>The OLPC project specifies <a href="http://wiki.laptop.org/go/Canonical_JSON" target="_blank">Canonical
JSON</a>. While this is used in
<a href="http://theupdateframework.com/" target="_blank">TUF</a>, which may be used with other
distribution-related protocols, this alternative format has been proposed in
case the original source changes. Specifications complying with either this
specification or an alternative should explicitly call out the
canonicalization format. Except for key ordering, this specification is mostly
compatible.</p>
<h3 id="go">Go</h3>
<p>In Go, the <a href="http://golang.org/pkg/encoding/json/" target="_blank"><code>encoding/json</code></a> library
will emit canonical JSON by default. Simply using <code>json.Marshal</code> will suffice
in most cases:</p>
<pre class="language-"><code class="lang-go">incoming <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
    <span class="token string">&quot;asdf&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;qwer&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;zxcv&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
        <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">1e9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;tyui&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

canonical<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>incoming<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... handle error</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To apply canonical JSON format spacing to an existing serialized JSON buffer, one
can use
<a href="http://golang.org/src/encoding/json/indent.go?s=1918:1989#L65" target="_blank"><code>json.Indent</code></a>
with the following arguments:</p>
<pre class="language-"><code class="lang-go">incoming <span class="token operator">:=</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> canonical bytes<span class="token punctuation">.</span>Buffer
<span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Indent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>canonical<span class="token punctuation">,</span> incoming<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... handle error</span>
<span class="token punctuation">}</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Reference Overview">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="manifest-v2-1.html" class="navigation navigation-next " aria-label="Next page: Image Manifest V 2 Schema 1">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"published":false,"title":"Docker Distribution JSON Canonicalization","description":"Explains registry JSON objects","keywords":["registry, service, images, repository,  json"],"level":"1.2.6","depth":2,"next":{"title":"Image Manifest V 2 Schema 1","level":"1.2.7","depth":2,"path":"spec/manifest-v2-1.md","ref":"spec/manifest-v2-1.md","articles":[]},"previous":{"title":"Reference Overview","level":"1.2.5","depth":2,"path":"spec/index.md","ref":"spec/index.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"distribution 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"spec/json.md","mtime":"2023-01-31T01:27:31.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-01-31T01:28:02.961Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

